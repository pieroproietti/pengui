#!/bin/bash
source bin/program
source bin/version
PROGRAM_VERSION=${PROGRAM}-${VERSION}
arch=$(uname -m)
if [[ $arch == x86_64* ]]; then
    ARCHITECTURE="_amd64"
elif [[ $arch == i*86 ]]; then
    ARCHITECTURE="_i386"
elif  [[ $arch == aarch64 ]]; then
    ARCHITECTURE="_arm64"
fi
echo "smartcheck packaging..."
# clean
rm ${PROGRAM}-*.deb ${PROGRAM}-*.bin fakeroot -rf
# create fakeroot scructure
mkdir -p fakeroot/opt/${PROGRAM}
mkdir -p fakeroot/usr/share/applications
mkdir -p fakeroot/usr/share/icons/hicolor/scalable/apps/
mkdir -p fakeroot/usr/bin
# copy files in fakeroot
cp assets/${PROGRAM}.svg fakeroot/usr/share/icons/hicolor/scalable/apps/
cp assets/${PROGRAM}.desktop fakeroot/usr/share/applications
# here we are copying the link
cp -P assets/${PROGRAM}.link fakeroot/usr/bin/${PROGRAM}
cp -r ${PROGRAM}.bin fakeroot/opt/${PROGRAM}
find fakeroot/opt/${PROGRAM} -type f -exec chmod 644 -- {} +
find fakeroot/opt/${PROGRAM} -type d -exec chmod 755 -- {} +
find fakeroot/usr/share -type f -exec chmod 644 -- {} +
chmod +x fakeroot/opt/${PROGRAM}/${PROGRAM}.bin
fpm -C fakeroot -s dir -t deb -n "${PROGRAM}" -v ${VERSION} -p ${PROGRAM_VERSION}${ARCHITECTURE}.deb
cp ${PROGRAM}.bin ${PROGRAM}-${VERSION}${ARCHITECTURE}.bin
rm fakeroot -rf
